<% if @erb_code %>
  <%= render inline: ERB.new(@erb_code).result(binding) %>
  
<% else %>
<div class="pagination"><%= will_paginate models %></div>
<h4><%= @title %></h4>
<p> <%= label_tag(:whs_name, t("Warehouse")) %>
	<%= select_tag(:whs_id, options_for_select(return_misc_definitions('warehouse').map{|r| [r.name, r.id]}), include_blank: true) %></p>
    <table class="table table-striped">
		<tr>
			<th>#</th>
			<th><%= t('Request Date') %></th>
			<th><%= t('Item Name') %></th>
			<th><%= t('Spec') %></th>
			<th><%= t('Requested Qty') %></th>
			<th><%= t('Requested By') %></th>
			<th><%= t('Out Qty') %></th>				
			<th><%= t('Checkout By') %></th>
			<th><%= t('WF State') %></th>
			<th><%= t('Last Updated By') %></th>
			<th></th>
			<th></th>
			
		</tr>
		<% models.each do |r| %>
		  <tr>
		  	<% if has_action_right?('show', params[:controller], r) %>
		  	  <td><%= link_to r.id, SUBURI + "/view_handler?index=1&url=#{checkout_path(r)}" %></td>
		  	<% else %>
		  	  <td><%= r.id %></td>
		  	<% end %>
		  	<td><%= r.request_date.strftime("%Y/%m/%d") %></td>
		  	<% if has_action_right?('show', ItemCheckoutx.item_class.to_s.underscore.pluralize, r.item) %>
		  	  <td><%= link_to r.item.name, SUBURI + "/view_handler?index=1&url=#{SUBURI + petty_warehousex.item_path(r.item)}" %></td>
		  	<% else %>
		  	  <td><%= r.item.name %></td>
		  	<% end %>
		  	<td><%= r.item.spec %></td>
		  	<td><%= prt(r, :requested_qty) %></td>
			<td><%= prt(r, 'requested_by.name') if r.requested_by_id.present? %></td> 
			<td><%= prt(r, :out_qty) %></td>
			<td><%= prt(r, 'checkout_by.name') if r.checkout_by_id.present? %></td>
			<td><%= t(prt(r, :wf_state).humanize.titleize) if r.wf_state.present? %></td>			
			<td><%= prt(r, 'last_updated_by.name') if r.last_updated_by_id.present? %></td>    
			<td><%= link_to t('Submit Checkout'), SUBURI + "/view_handler?index=1&url=#{CGI.escape event_action_checkout_path(r, :wf_event => 'submit', :resource_id => r.id)}", :class => BUTTONS_CLS['action']  if r.wf_state.present? && r.wf_state == 'initial_state' && has_action_right?('submit', params[:controller], r) %></td>
			<td><%= link_to t('Approve'), SUBURI + "/view_handler?index=1&url=#{CGI.escape event_action_checkout_path(r, :wf_event => 'approve', :resource_id => r.id)}", :class => BUTTONS_CLS['action']  if r.wf_state.present? && r.wf_state == 'reviewing' && has_action_right?('approve', params[:controller], r) %></td>
			<td><%= link_to t('Reject'), SUBURI + "/view_handler?index=1&url=#{CGI.escape event_action_checkout_path(r, :wf_event => 'reject', :resource_id => r.id)}", :class => BUTTONS_CLS['action']  if r.wf_state.present? && r.wf_state == 'reviewing' && has_action_right?('reject', params[:controller], r) %></td>
            <td><%= link_to t('Rewind'), SUBURI + "/view_handler?index=1&url=#{CGI.escape event_action_checkout_path(r, :wf_event => 'rewind', :resource_id => r.id)}", :class => BUTTONS_CLS['action']  if r.wf_state.present? && r.wf_state == 'reviewing' && has_action_right?('rewind', params[:controller], r) %></td>
		    <td><%= link_to t('Release'), SUBURI + "/view_handler?index=1&url=#{CGI.escape event_action_checkout_path(r, :wf_event => 'release', :resource_id => r.id, :item_id => r.item_id)}", :class => BUTTONS_CLS['action']  if r.wf_state.present? && r.wf_state == 'approved' && has_action_right?('release', params[:controller], r) %></td>
			<td><%= link_to t('Edit'), SUBURI + "/view_handler?index=1&url=#{edit_checkout_path(r)}", :class => BUTTONS_CLS['action']  if has_action_right?('update', params[:controller], r) %></td>
			
		  </tr>
		<% end %>
	</table>
	
	<table class="table table-striped">
	  <tr>
	    <th>
	    	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	    	<%= link_to t('Back'), SUBURI + "/view_handler?index=0", :class => BUTTONS_CLS['action']  %>
	    	<%= link_to t('Submited Requests'), SUBURI + "/view_handler?index=1&url=#{list_items_checkouts_path(:wf_state => 'initial_state')}", :class => BUTTONS_CLS['action']  if  has_action_right?('list_submitted_items', params[:controller]) %>
            <%= link_to t('Reviewing Requests'), SUBURI + "/view_handler?index=1&url=#{list_items_checkouts_path(:wf_state => 'reviewing')}", :class => BUTTONS_CLS['action']  if  has_action_right?('list_reviewing_items', params[:controller]) %>
	    	<%= link_to t('Approved Requests'), SUBURI + "/view_handler?index=1&url=#{list_items_checkouts_path(:wf_state => 'approved')}", :class => BUTTONS_CLS['action']  if  has_action_right?('list_approved_items', params[:controller]) %>
	    	<%= link_to t('Rejected Requests'), SUBURI + "/view_handler?index=1&url=#{list_items_checkouts_path(:wf_state => 'rejected')}", :class => BUTTONS_CLS['action']  if  has_action_right?('list_rejected_items', params[:controller]) %>
	    	<%= link_to t('Released Requests'), SUBURI + "/view_handler?index=1&url=#{list_items_checkouts_path(:wf_state => 'checkedout')}", :class => BUTTONS_CLS['action']  if  has_action_right?('list_checkedout_items', params[:controller]) %>
	    </th>
	  </tr>
	</table>
<% end %>

